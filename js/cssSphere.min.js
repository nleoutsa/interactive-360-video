function CssSphere(a){function d(){b.perspective=b.sceneHeight/2+b.sceneHeight/8+b.sceneHeight/32+b.sceneHeight/128}function e(){requestAnimationFrame(function(){var a=document.getElementById("video-play-image");b.videoElement.currentTime>0&&!b.videoElement.paused&&!b.videoElement.ended?a.setAttribute("src","images/pause.png"):a.setAttribute("src","images/play.png")})}function f(a,b){var c=a.options.transform,d=a.options.animationEnd,e=a.options.start,f=a.options.end,g=f-e,h=(b-e)/g,i=d[1]-c[1],j=h*i;a.updateGlobalRotation("y",c[1]+j);var k=d[0]-c[0],l=h*k;a.updateGlobalRotation("x",c[0]+l)}var c,b=this;this.container=document.getElementById(a||"cssSphereContainer"),this.perspective=b.sceneHeight/2+b.sceneHeight/8+b.sceneHeight/32+b.sceneHeight/128,this.rotation=function(){return b.camera.components.rotation.data},this.generateScene=function(a,f){function p(){var a=document.createElement("div"),c=document.createElement("div"),d=document.createElement("div"),f=document.createElement("div");return a.style.position="fixed",a.style.right=0,a.style.left=0,a.style.bottom=0,a.style.height="30px",a.style.borderTop="2px solid #fff",a.style.zIndex=999999999,k.style.position="absolute",k.style.left=0,k.style.width="20px",k.style.top=0,k.style.bottom=0,k.style.padding="5px",k.style.borderRight="2px solid #fff",k.style.cursor="pointer",c.style.position="absolute",c.style.right=0,c.style.left="32px",c.style.top=0,c.style.bottom=0,c.style.cursor="pointer",c.style.backgroundColor="rgba(0,0,0,0.7)",d.style.position="absolute",d.style.right="100%",d.style.left=0,d.style.top=0,d.style.bottom=0,d.style.backgroundColor="#962312",f.style.position="absolute",f.style.left="10px",f.style.height="30px",f.style.lineHeight="30px",f.style.color="#fff",f.innerHTML=0,f.style.userSelect="none",b.progressElement=d,b.progressTime=f,k.addEventListener("click",function(){b.videoElement.currentTime>0&&!b.videoElement.paused&&!b.videoElement.ended?b.videoElement.pause():b.videoElement.play(),e()}),c.addEventListener("click",function(a){b.videoElement.currentTime=b.videoElement.duration*a.offsetX/this.clientWidth}),a.appendChild(k),c.appendChild(d),c.appendChild(f),a.appendChild(c),a}if(!a||"object"!=typeof a)return void console.warn("Must provide options object.");var g,h,i,j,k,l,m,n,o;if(this.addedDOMElements=[],this.visibleDOMElements=[],a.src&&"string"==typeof a.src&&(g=a.src.split(".").pop()),b.editMode=!!a.editMode,b.aScene=document.createElement("a-scene"),"mp4".indexOf(g)>-1&&a.controls?(j=document.createElement("a-assets"),k=document.createElement("img"),k.setAttribute("id","video-play-image"),k.setAttribute("src","images/play.png"),l=document.createElement("img"),l.setAttribute("id","video-pause-image"),l.setAttribute("src","images/pause.png"),m=document.createElement("video"),m.setAttribute("id","video_1"),m.setAttribute("src",a.src),b.videoElement=m,o=document.createElement("a-entity"),o.setAttribute("video-controls","src:#video_1"),j.appendChild(k),j.appendChild(l),j.appendChild(m),"aframe"===a.controlsType&&(n=document.createElement("a-cursor"),n.setAttribute("id","cursor"),n.setAttribute("material","color: cyan;"),o.setAttribute("position","0 0 -2")),b.aScene.appendChild(o),"aframe"!==a.controlsType&&(b.container.appendChild(p()),window.addEventListener("keyup",function(a){switch(a.keyCode){case 32:e()}},!1)),b.aScene.appendChild(j),i=document.createElement("a-videosphere"),i.setAttribute("src","#video_1")):["mp4","jpg","jpeg","png","svg","gif","tiff"].indexOf(g)>-1?(i=document.createElement("a-sky"),i.setAttribute("src",a.src)):(i=document.createElement("a-sky"),i.setAttribute("color",a.src||"#fff")),h=document.createElement("a-entity"),h.setAttribute("camera",""),h.setAttribute("look-controls",""),b.camera=h,n&&h.appendChild(n),b.aScene.appendChild(h),b.aScene.appendChild(i),b.sphere=document.createElement("div"),b.sphere.setAttribute("id","cssSphere"),b.container.appendChild(b.aScene),b.container.appendChild(b.sphere),b.sphere.style.transform="perspective("+b.perspective+"px) translateX(0) translateY(0) translateZ(0) rotateX(0deg) rotateY(0deg) rotateZ(0deg)",window.onload=function(){b.sceneHeight=b.aScene.canvas.clientHeight,d(),c=b.progressElement,b.updateSphere(0)},window.onresize=function(){d()},f){if("function"!=typeof f)return void console.warn("typeof callback parameter ["+f+"] is ["+typeof f+"]. It should be a function.");f()}},this.seekToTime=function(a){b.videoElement.currentTime=a,b.videoElement.play(),e()},this.addDOMElementToScene=function(a){var c=document.getElementById(a.id),d=new CssSphereDOMElement(c);d.options=a,b.addedDOMElements.push(d),d.currentlyVisible=!1},this.addElementToScene=function(a,c){a.parentSphere=b,b.editMode&&a.setupControllers(),a.setPositionFromArray(c||[0,0,0,0,0,0,0,0,0,0,0,0]),a.currentlyVisible=!0,b.sphere.appendChild(a.el()),b.visibleDOMElements.push(a)},this.removeElementFromScene=function(a){a.currentlyVisible=!1,b.sphere.removeChild(a.el()),b.visibleDOMElements.splice(a,1)},this.updateSphere=function(a){window.requestAnimationFrame(function(){var h,i,d=b.rotation(),e=b.videoElement.duration,g=b.videoElement.currentTime;if(b.sphere.style.transform="perspective("+b.perspective+"px) translateX(0) translateY(0) translateZ(0) rotateX("+d.x+"deg) rotateY("+-d.y+"deg)",c&&(c.style.right=100-100*g/e+"%",b.progressTime.innerHTML=g.toFixed(2)+" / "+e.toFixed(2)),a%20===0)for(i=0;i<b.addedDOMElements.length;i++)h=b.addedDOMElements[i],h.options.start>=g||h.options.end<=g?h.currentlyVisible===!0&&b.removeElementFromScene(h):h.currentlyVisible===!1&&b.addElementToScene(h,h.options.transform);for(i=0;i<b.visibleDOMElements.length;i++)h=b.visibleDOMElements[i],h.options.animationEnd&&f(h,g);if(b.editMode)for(i=0;i<b.visibleDOMElements.length;i++)h=b.visibleDOMElements[i],h.activeGlobalRotationControllers.x&&h.updateGlobalRotation("x",-d.x+-h.startingRotation.x),h.activeGlobalRotationControllers.y&&h.updateGlobalRotation("y",d.y+h.startingRotation.y);b.updateSphere(a+1)})}}function CssSphereDOMElement(a){function e(a){a.style.textAlign="center",a.style.userSelect="none",a.style.cursor="pointer",a.style.fontSize="44px",a.style.position="absolute",a.style.transformStyle="preserve-3d"}function f(a){var c=b.axes,d=c[a],f=document.createElement("div");f.style.height="50px",f.style.width="150px",f.style.borderRadius="10px",f.innerHTML=(0===a?"Y":"X")+" Lock",f.style.backgroundColor="#ddd",e(f),f.style.transform="translateX(25px) translateY("+70*(a+1)+"px)",f.addEventListener("click",function(a){a.preventDefault(),b.activeGlobalRotationControllers[d]?(f.style.backgroundColor="#ddd",b.activeGlobalRotationControllers[d]=!1,k(b.transforms)):(f.style.backgroundColor="#db6327",b.startingRotation.x=-b.transforms.global.rotation.x-b.parentSphere.rotation().x,b.startingRotation.y=b.transforms.global.rotation.y-b.parentSphere.rotation().y,b.activeGlobalRotationControllers[d]=!0)}),this.el=function(){return f}}function g(){var b,c,a=document.createElement("div");for(c=0;c<3;c++)b=i(c),b.appendChild(h(c,"Rotation")),b.appendChild(h(c,"Translation")),b.appendChild(h(c,"Scale")),a.appendChild(b);e(a),a.style.transform="translateX(520px) translateY(100px) rotateX(70deg) rotateZ(15deg) rotateY(0deg)",this.el=function(){return a}}function h(a,c){var i,j,l,d=b.axes[a],e=document.createElement("div"),f=!1,g={},h=30;if(e.className=c+"-knob three-d "+d+"-axis-color","Scale"===c&&2!==a){for(l=0;l<6;l++)i=document.createElement("div"),i.className=c+"-knob-side three-d "+d+"-axis-color",0===l?i.style.transform="translateZ(-10px)":1===l?i.style.transform="translateY("+h/2+"px) translateZ(4px) rotateX(90deg)":2===l?i.style.transform="translateZ("+(h/2+4)+"px)":3===l?i.style.transform="translateY(-"+h/2+"px) translateZ(4px) rotateX(90deg)":4===l?i.style.transform="translateX("+h/2+"px) translateZ(4px) rotateY(90deg)":5===l&&(i.style.transform="translateX(-"+h/2+"px) translateZ(4px) rotateY(90deg)"),e.appendChild(i);document.addEventListener("mousemove",function(a){a.preventDefault(),f&&(j=(a["client"+d.toUpperCase()]-g[d])*("y"===d?-1:1),b["update"+c](d,j))})}else if("Translation"===c){for(l=0;l<4;l++)i=document.createElement("div"),i.className=c+"-knob-side three-d "+d+"-axis-color",0===l?i.style.transform="translateY(8px) rotateX(90deg) rotateY(-18deg)":1===l?i.style.transform="translateY(-8px) rotateX(90deg) rotateY(18deg)":2===l?i.style.transform="translateZ(-8px) rotateY(-18deg)":3===l&&(i.style.transform="translateZ(8px) rotateY(18deg)"),e.appendChild(i);document.addEventListener("mousemove",function(a){a.preventDefault(),f&&(j="y"===d?a.clientY-g.y:(a.clientX-g.x)*("z"===d?-1:1),b["update"+c](d,j))})}else"Rotation"===c&&document.addEventListener("mousemove",function(a){a.preventDefault(),f&&(j=a.clientY-g.y+(a.clientX-g.x),"x"===d&&(j*=-1),b["update"+c](d,j))});return e.addEventListener("mousedown",function(a){a.preventDefault(),g.x=a.clientX,g.y=a.clientY,"Rotation"===c&&(g.top=b.local_transform_controller.el().getBoundingClientRect().top,g.left=b.local_transform_controller.el().getBoundingClientRect().left),f=!0,e.classList.toggle("active_knob")}),document.addEventListener("mouseup",function(a){a.preventDefault(),f&&(f=!1,e.classList.toggle("active_knob"),k(b.transforms))}),e}function i(a){var e,f,c=b.axes[a],d=document.createElement("div");for(f=0;f<4;f++)e=document.createElement("div"),e.className="controller-handle-side three-d "+c+"-axis-color",1===f?e.style.transform="translateY(4px) translateZ(4px) rotateX(90deg)":2===f?e.style.transform="translateZ(8px)":3===f&&(e.style.transform="translateY(-4px) translateZ(4px) rotateX(90deg)"),d.appendChild(e);return d.className="handle three-d "+c+"-axis "+c+"-axis-transform",d}function j(a){var b=["undo","redo"][a],c=[-1,1][a],d=document.createElement("div");d.style.fontSize="38px",d.style.padding=" 2px 10px",d.style.backgroundColor="#ddd",d.style.transform="translateY(6px) translateX("+(6+100*a)+"px)",d.innerHTML=b,e(d),d.style.display="none",d.addEventListener("click",function(a){a.preventDefault(),l(c)}),this.el=function(){return d}}function k(a){b.transformHistory.splice(b.transformHistoryState+1,b.transformHistory.length,b.getArrayFromPosition(a)),b.transformHistoryState=b.transformHistory.length-1}function l(a){var c=b.transformHistoryState+a;c>=0&&c<b.transformHistory.length&&(b.setPositionFromArray(b.transformHistory[c]),b.transformHistoryState+=a)}var b=this,c=document.createElement("div"),d=document.createElement("div");c.style.position="absolute",c.style.transformStyle="preserve-3d",d.style.position="absolute",d.style.transformStyle="preserve-3d",a.style.display="block",d.appendChild(a),c.appendChild(d),this.transforms={},this.transforms.global={},this.transforms.local={},this.transforms.global.rotation={},this.transforms.local.translation={},this.transforms.local.rotation={},this.transforms.local.scale={},this.activeGlobalRotationControllers={},this.startingRotation={},this.axes=["x","y","z"],this.local_transform_controller,this.transformHistory=[],this.transformHistoryState=0,this.setupControllers=function(){var d,e,a=new b.GlobalTransformController;for(e=0;e<2;e++)d=new f(e),a.appendChild(d.el()),d=new j(e),a.appendChild(d.el());b.local_transform_controller=new g,a.appendChild(b.local_transform_controller.el()),c.appendChild(a)},this.GlobalTransformController=function(){var a=document.createElement("div");return a.style.borderRadius="10px",a.style.backgroundColor="#444",a.style.transform="translateX(-600px) translateY(-1700px) scale(3)",a},this.updateGlobalRotation=function(a,b){this.transforms.global.rotation[a]=b,this.updatePosition()},this.updateTranslation=function(a,b){this.transforms.local.translation[a]=10*b,this.updatePosition()},this.updateRotation=function(a,b){this.transforms.local.rotation[a]=b,this.updatePosition()},this.updateScale=function(a,b){this.transforms.local.scale[a]=b/10,this.updatePosition()},this.updatePosition=function(){var a="rotateY("+this.transforms.global.rotation.y+"deg)rotateX("+this.transforms.global.rotation.x+"deg)rotateZ("+this.transforms.global.rotation.z+"deg)translateX("+this.transforms.local.translation.x+"px)translateY("+this.transforms.local.translation.y+"px)translateZ("+(-5e3+this.transforms.local.translation.z)+"px)",b="rotateY("+this.transforms.local.rotation.y+"deg)rotateX("+this.transforms.local.rotation.x+"deg)rotateZ("+this.transforms.local.rotation.z+"deg)scaleX("+(5+this.transforms.local.scale.x)+")scaleY("+(5+this.transforms.local.scale.y)+")scaleZ("+(5+this.transforms.local.scale.z)+")";c.style.transform=a,d.style.transform=b},this.setPositionFromArray=function(a){var d,e,c=b.axes;for(d=0;d<c.length;d++)e=c[d],this.transforms.global.rotation[e]=a[d],this.transforms.local.translation[e]=a[3+d],this.transforms.local.rotation[e]=a[6+d],this.transforms.local.scale[e]=a[9+d];this.updatePosition(),k(this.transforms)},this.getArrayFromPosition=function(a){var e,f,c=[],d=b.axes;for(e=0;e<d.length;e++)f=d[e],c[e]=a.global.rotation[f],c[3+e]=a.local.translation[f],c[6+e]=a.local.rotation[f],c[9+e]=a.local.scale[f];return c},this.el=function(){return c}}
